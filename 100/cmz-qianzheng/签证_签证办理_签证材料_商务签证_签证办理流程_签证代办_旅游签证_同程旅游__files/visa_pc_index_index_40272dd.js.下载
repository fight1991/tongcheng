define("visa/pc/index/index",["modules/dialog/0.2.0/dialog","modules/slidertoolbar/0.1.0/index","modules/common/0.1.0/index","modules/login/0.1.0/index","visa/pc/index/indexorder","visa/pc/index/prolist","modules/lazyload/0.1.0/index"],function(e,t,a){window.host="//www.ly.com";var o=e("dialog/0.2.0/dialog"),i=e("slidertoolbar/0.1.0/index"),s=e("common/0.1.0/index"),n=e("login/0.1.0/index"),r=e("visa/pc/index/indexorder"),l=e("visa/pc/index/prolist");e("lazyload/0.1.0/index");var c={};Visa={orderEle:{url:"/dujia/AjaxCallTravel.aspx?type=GetVisaOrderProcess&customerSerialId=",matchUrl:"/dujia/AjaxCallTravel.aspx?type=ValidateCode&r=",proUrl:"/dujia/AjaxcallTravel.aspx?type=GetContinentHotProduct&continentId=",silderUrl:"//www.ly.com/intervisa/ajax/cnvisa/getVisaAds?ImgType=51,52,67",packetUrl:"/dujia/AjaxCall.aspx?Type=GetRedBagOnce"},init:function(){var e=this;e.clickEvent(),e.lazyLoad(),e.hoverEvent(),e.saveHotData(),e.visaScroll(),e.sideadfn(function(){e.hideNumber()}),$dialog=new o({skin:"skin2"})},hideNumber:function(){$.ajax({url:"//www.ly.com/dujia/AjaxCall.aspx?Type=GetFocusValue",dataType:"jsonp",success:function(e){var t="";if(e&&e.totalseconds){var a=e.totalseconds.replace(/-/g,"/");t=s.dateFormat(new Date(a),"yyyyMMdd")}else{var o=new Date;t=s.dateFormat(o,"yyyyMMdd")}t>20170126&&20170203>t&&$(".module-slider-top").find("li").eq(1).css("display","none")}})},getQueryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},clickEvent:function(){var e=window.host;$("#imgcode").attr("src",e+Visa.orderEle.matchUrl+Math.random()),$(document).on("click",".J_visaPlan-btn",function(){var t=$(".J_input-orderId"),a=$(".J_input-phone"),o=$(".J_input-validCode"),i=t.val(),s=a.val(),n=o.val();t.css({color:"#333"}),a.css({color:"#333"}),o.css({color:"#333"});var l=$(".ui-vailTips").find("p"),c=l.children("span");if(""===i||""===s||""===n)return l.removeClass("none"),void c.text("进度查询条件不可为空");if(9!==i.length)return l.removeClass("none"),c.text("请填写正确订单号"),void $(".J_input-orderId").css({color:"red"});if(!Visa.isPhone(s))return l.removeClass("none"),c.text("请填写正确手机号码"),void $(".J_input-phone").css({color:"red"});var d=e+Visa.orderEle.url+i+"&mobile="+s+"&checkCode="+n;$.ajax({url:d,dataType:"jsonp",success:function(e){if(l.addClass("none"),c.text(""),200===e.state)"022"===JSON.parse(e.data).No&&(l.removeClass("none"),c.text("请填写正确验证码"),$(".J_input-validCode").css({color:"red"}));else if(300===e.state)l.removeClass("none"),c.text("请先登录");else if(null===JSON.parse(e.data).CustomerSerialId){var t={width:"435px",height:"205px",title:"",type:"html",isdrag:!1,content:$(".J_noResult").html()};$dialog.modal(t)}else{var a=[];a.push(JSON.parse(e.data)),Visa.render({tpl:r,data:a,context:".ui-searchResult",overwrite:!0,callback:function(){}});{var o={width:"583px",height:"610px",title:"",isdrag:!1,type:"html",content:$(".J_searchResult").html()};$dialog.modal(o)}}}})}),$("#orderId,#phone").on("focus",function(){$(this).css("border","1px solid #8297b0")}).on("blur",function(){$(this).css("border","1px solid #ddd")}),$("#validCode").on("focus",function(){$(this).css("border","1px solid #ff7800")}).on("blur",function(){$(this).css("border","1px solid #ddd")}),$(".searchBtn").on("click",function(){Visa.searchVisa()}),$("#visaType").on("click",function(e){e.stopPropagation();var t=$(this);t.hasClass("icon-down")?(t.removeClass("icon-down").addClass("icon-up"),$(".visa_type").css({display:"block"})):(t.removeClass("icon-up").addClass("icon-down"),$(".visa_type").css({display:"none"}))}),$(".visa_type").on("click","li",function(){var e=$(this),t=$("#visaType");t.data("sttrid",e.attr("sttrid")),t.val(e.text()),t.removeClass("icon-ip").addClass("icon-down"),$(".visa_type").css({display:"none"})}),$("#sCountry").on("focus",function(){var e=$(this);"输入您需要签证的国家/地区"===e.val()&&e.val("")}).on("blur",function(){var e=$(this);""===e.val()&&e.val("输入您需要签证的国家/地区")}),$(document).on("click",function(){$(".visa_type").css({display:"none"}),$("#visaType").removeClass("icon-up").addClass("icon-down")}),$(document).on("mouseover",".proLists-tab-panel ul li",function(){var e=$(this).find(".ui-freeVisa-footer");e.addClass("on")}),$(document).on("mouseout",".proLists-tab-panel ul li",function(){var e=$(this).find(".ui-freeVisa-footer");e.removeClass("on")}),$(".J_visaHelp").on("click",function(){var e=$(this),t=$(".ui-visaHelp-list");$(".J_visaHelp").removeClass("on"),e.addClass("on"),t.addClass("none"),t.each(function(){var t=$(this),a=e.index(),o=t.index();0===a&&4>o&&t.removeClass("none"),1===a&&o>3&&8>o&&t.removeClass("none"),2===a&&o>7&&t.removeClass("none")})}),$(document).on("click",".J_btnPkOn,.J_btnPKClose,.J_btnPKUse",function(){var e=$(this),t=$(".packet-btn"),a=".packet-main,.packet-bg-color,.packet-bg-img";e.hasClass("open")?t.stop().animate({left:"-137px"},300,function(){$(a).show()}):($(a).hide(),t.stop().animate({left:"0px"},300))}),$(document).on("click",".J_btnPKGet",function(){var e=Visa.getUser();if(e)$.ajax({url:Visa.orderEle.packetUrl+"&mid="+e+"&UnEncode=1&pageid=2010&fromvisa=1",dataType:"jsonp",success:function(e){var t=$(".packet-view");"100"==e.status?($(".packet-cloud").hide(),t.find(".pop1").hide(),t.find(".pop2").show()):"104"==e.status&&($(".packet-cloud").hide(),t.find(".pop1").hide(),t.find(".pop3").show())}});else{var t=$(".packet-btn"),a=".packet-main,.packet-bg-color,.packet-bg-img";$(a).hide(),t.stop().animate({left:"0px"},300);{new n({loginSuccess:function(){}})}}})},isPhone:function(e){return/^(13[0-9]|14[0-9]|15[0-9]|16[0-9]|17[0-9]|19[0-9]|18[0-9])\d{8}$/.test(e)},lazyLoad:function(){var e=this;if(e.isInit){var t=$(".ui-proLists-content img").not("[data-img-loaded]");$(window).trigger("addElements",t)}else $(".ui-proLists-content img").lazyload({data_attribute:"img",event:"scroll",effect:"fadeIn"}),e.isInit=!0;$(window).trigger("scroll")},hoverEvent:function(){var e=$(".J_proLists-country").children()[0],t=($(".ui-proLists-content").children()[0],"查看更多"+$(e).html()+"签证");$(e).addClass("cur"),$(".ui-proLists-more a").attr("href",$(e).attr("data-url")),$(".ui-proLists-more a").html(t);var a,o=$(".J_hotSearch-box li"),i=$(".J_hotVisa-proList"),s=$(".J_proLists-country li");o.mouseenter(function(){var e=$(this);e.addClass("ui-hotCity-select"),e.children(".ui-hotCities-more").show(),a=e.index()+1,e.find(".J_ui-icon").removeClass("ui-icon-normal"+a).addClass("ui-icon-normal"+a+"-"+a)}),o.mouseleave(function(){var e=$(this);e.removeClass("ui-hotCity-select"),e.children(".ui-hotCities-more").hide(),e.find(".J_ui-icon").removeClass("ui-icon-normal"+a+"-"+a).addClass("ui-icon-normal"+a)}),i.mouseenter(function(){var e=$(this);e.children(".J_proCover").addClass("ui-proCover-ie"),e.children(".J_proCover").css("background-color","rgba(0,0,0,0.5)"),e.children(".J_proCover").addClass("ui-proCover-active").stop().animate({top:"0%"})}),i.mouseleave(function(){var e=$(this);e.children(".J_proCover").stop().animate({top:"54%"},500,function(){e.children(".J_proCover").removeClass("ui-proCover-ie"),e.children(".J_proCover").css("background-color","rgba(0,0,0,0)")})}),s.on("click",function(){var e=($(this).index(),$(this).attr("data-id")),t=$.trim($(this).text());s.removeClass("cur"),$(this).addClass("cur"),$(".ui-proLists-more a").attr("href",$(this).attr("data-url"));var a="查看更多"+$(this).html()+"签证";if($(".ui-proLists-more a").html(a).attr("trackspot",a),c[e])$(".ui-proLists-content").empty().html(c[e]),Visa.lazyLoad();else{var o=window.host,i=o+Visa.orderEle.proUrl+$(this).attr("data-id");$.ajax({url:i,dataType:"jsonp",success:function(a){if(100===a.state){var o=JSON.parse(a.data),i={id:e,indexName:t,list:o};Visa.render({tpl:l,data:i,context:".ui-proLists-content",overwrite:!0,callback:function(){Visa.lazyLoad(),Visa.saveHotData()}})}else 200===a.state&&$(".proLists-tab-panel").html("暂时没有数据了！")},error:function(){$(".proLists-tab-panel").html("暂时没有数据了！")}})}})},saveHotData:function(){var e=$(".J_proLists-country .cur").attr("data-id"),t=$(".proLists-tab-panel").html()||"";t&&(c[e]=t)},visaScroll:function(){function e(){i.offsetTop-a.scrollTop<=1480?a.scrollTop-=o.offsetHeight:a.scrollTop++}var t=40,a=document.getElementById("J_visaNew-list"),o=document.getElementById("visaNew-hide"),i=document.getElementById("visaNew-show");i.innerHTML=o.innerHTML;var s=setInterval(e,t);a.onmouseover=function(){clearInterval(s)},a.onmouseout=function(){s=setInterval(e,t)}},searchVisa:function(){function e(e){$.ajax({url:e,dataType:"jsonp",success:function(e){""!==$.trim(e)?window.location.href=e:($(".pop_main").html("暂无该国家签证，请重新输入"),$(".popBox").addClass("popBox_show"),setTimeout(function(){$(".popBox").removeClass("popBox_show")},3e3))}})}var t,a=function(){var e=parseInt($("#visaType").data("sttrid"),10);return isNaN(e)?e="":e},o=$.trim($("#sCountry").val());"请输入您需要签证的国家/地区"!==o&&""!==o?(t=$(".searchBtn").attr("data-search-ajax")+"&cityname="+encodeURI(o)+"&citytype="+encodeURI(a())+"&locality=0",e(t)):$("#sCountry").focus()},getUser:function(){var e,t=$.cookie("us");return t&&(e=/userid=(\d+)/i.exec(t),e=e?e[1]:e),e},render:function(e){var t,a,o=e.key,i=e.tpl[o]||e.tpl,s=e.data[o]||e.data,n=$(e.context),r=e.callback;t=i(s),e.overwrite&&n.empty(),a=$(t).appendTo(n),r&&$.isFunction(r)&&r.call(a,e)},getUrlParam:function(){var e=location.search,t={};if(-1!=e.indexOf("?")){var a=e.substr(1);strs=a.split("&");for(var o=0;o<strs.length;o++)t[strs[o].split("=")[0]]=strs[o].split("=")[1];return t}},sideadfn:function(e){var t=this;$.ajax({url:t.orderEle.silderUrl,dataType:"jsonp",success:function(a){var o={},i={},s={},n={};if(a&&a.length)for(var r=0;r<a.length;r++)if(51===a[r].ImgType)o=(a[r].ImgList||[])[0]||{};else if(52===a[r].ImgType)i=(a[r].ImgList||[])[0]||{};else if(67===a[r].ImgType)for(var l=a[r].ImgList||[],c=0;c<l.length;c++)1===l[c].Sort?s=l[c]:2===l[c].Sort&&(n=l[c]);t.slider(o,i),t.bottomSlider(s,n),e&&e.call(t),console.log("ok")}})},slider:function(e,t){var a=Visa.getUser(),o=new i({header:{icon:'<a target="_blank" trackspot="签证首页^'+e.ImgName+'^small" trace="slider_1" href="'+(e.ShowUrl||"").replace("http:","")+'"><img src="'+(e.ImgUrl||"").replace("http:","")+'"></a>',tooltips:'<a target="_blank" trackspot="签证首页^'+t.ImgName+'^big" trace="slider_2" href="'+(t.ShowUrl||"").replace("http:","")+'"><img src="'+(t.ImgUrl||"").replace("http:","")+'"></a>'},topMenu:[{icon:'<a trace="slider_6" trackspot="Orders" href="//member.ly.com/center"><div class="ico c-1"></div></a>',tooltips:'<a trace="slider_7" trackspot="Orders" href="//member.ly.com/center"><span class="ico-title">我的同程<i></i></span></a>',arrow:!1},{icon:'<a><div class="ico c-7"></div></a>',tooltips:'<a><span class="ico-title"><img src="//pic5.40017.cn/02/001/da/d6/rBLkCVr49bGAR5bVAABSryN0PL4587.jpg"><i></i></span></a>',tooltipCls:"chujing-code",arrow:!1},{icon:'<a target="_blank" trace="slider_3" trackspot="Online_Service" href="//livechat.ly.com/out/guest?p=2&c=3"><div class="ico c-5"></div></a>',tooltips:'<a target="_blank" trace="slider_4" trackspot="Online_Service" href="//livechat.ly.com/out/guest?p=2&c=3"><span class="ico-title">在线客服<i></i></span></a>',arrow:!1}],bottomMenu:[{icon:'<a><div class="ico c-8"></div></a>',tooltips:'<a><span class="ico-title"><img src="//img1.40017.cn/cn/v/2015/index2016/app-download.png"><i></i></span></a>',tooltipCls:"app-code",arrow:!1}],pageName:"签证首页",toTop:!0,skin:"skin2"});a&&o.resetMenu({icon:'<a href="//member.ly.com/center"><div class="ico c-1-1"></div></a>',tooltips:'<a href="//member.ly.com/center"><span class="ico-title">我的同程<i></i></span></a>',arrow:!1},"top",0)},bottomSlider:function(e,t){if(e.ImgUrl&&t.ImgUrl){var a='<div class="bottom-small J_botSmallAds"><img src="'+(e.ImgUrl||"").replace("http:","")+'"></div><div class="bottom-Large J_botLargeAds none" style="left: -100%;"><div class="warp-bg"></div><div class="warp-con"><a class="warp-img" target="_blank" href="'+(t.ShowUrl||"").replace("http:","")+'"><img src="'+(t.ImgUrl||"").replace("http:","")+'"></a><a class="warp-close" href="javascript:void(0);"></a></div></div>';$("#ivacation-bottomSide-nav").html(a);var o=function(){$(".bottom-small").animate({left:"-206px"},500,"",function(){$(".bottom-Large").animate({left:"0px"},1e3),$(".bottom-Large").removeClass("none")})},i=function(){$(".bottom-Large").animate({left:"-100%"},500,"",function(){$(".bottom-Large").addClass("none"),$(".bottom-small").animate({left:"0px"},500)});var e=parseInt(fish.cookie.get("TCent.visa"))||0;fish.cookie.set("TCent.visa",e+1)};$(document).on("click",".warp-close",function(){i()}),$(document).on("click",".J_botSmallAds",function(){o()});var s=parseInt(fish.cookie.get("TCent.visa"))||0;2>s?o():""}}},a.exports=Visa});