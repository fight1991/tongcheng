!function(o){function t(){}function e(){}function n(){}t.prototype={isConsole:function(){return!!o.console&&this.getLogStatus()},isOnlineHost:function(){var o=location.host;return o.indexOf("www.ly.com")>-1||o.indexOf("wx.17u.cn")>-1||o.indexOf("m.ly.com")>-1||o.indexOf("ebk.17u.cn")>-1},getLogStatus:function(){var o=!this.isOnlineHost(),t=location.href.indexOf("debug")>-1,e=location.href.indexOf("monitor")>-1;return!e&&(o||t)},stringify:function(t){return"string"===(typeof t).toLowerCase()?t:o.JSON&&JSON.stringify?JSON.stringify(t):'{"message":"不支持stringify"}'},_sub:function(o,t){var e=this,n=e.stringify(e._tmpl.log),r=t?"&IntoError="+t:"";return e.isConsole()&&(n=e._tmpl.pretty),n.replace(/{{(\w+)}}/g,function(t,n){var r=o[n];return e.isConsole()?r:e.stringify(r)})+r},isNotExpire:function(o,t){var e=36e5,n=(new Date).getTime();return t&&"boolean"===(typeof t).toLowerCase()?!t:n-o<=(t||e)},index:function(o){if(!localStorage)return!0;var t=localStorage.__error__||"{}",e=JSON.parse(t);return e[o]&&this.isNotExpire(e[o])?void 0:(e[o]=(new Date).getTime(),localStorage.__error__=this.stringify(e),!0)},send:function(t){var e=new Image,n="__img__"+Math.random();o[n]=e,e.onload=e.onerror=function(){o[n]=null},e.src=t,e=null}},e.prototype=new t,$.extend(e.prototype,{prefix:"//www.ly.com/dujia/ajaxhelper/commonhandler.ashx?action=FRONTPERFORMANCE&type=FrontLogErr",_tmpl:{pretty:"在{{pageid}}发现{{errortype}}错误：\n \r {{message}}",log:{errortype:"{{errortype}}",host:"{{host}}",pageid:"{{pageid}}",message:"{{message}}",ua:"{{ua}}",width:"{{width}}",height:"{{height}}",url:"{{url}}"}},hostMap:{"(dj(test)?.t|www).ly.com":"pc","(m(test)?.t|m).ly.com":"touch","(wx(test)?.t|wx).17u.cn":"weixin","(ebk.t|ebk).17u.cn":"EBooking"},pageidMap:{pc:{"/dujia[/]?$":"pc-index","/dujiatag/w+/chujingyou/\\w+/\\d+.html":"pc-oldtag","/dujia/\\w+\\d+-\\w+":"pc-tag","/dujia/search.aspx":"pc-search","/dujia/temai[/]?$":"pc-temai","/dujia/yushou[/]?$":"pc-yushou","/dujia/tours/\\d+.html":"pc-gdetail","/dujia/tours/\\d+/":"pc-fdetail","/dujia/fillIn.aspx":"pc-booking","/zhuanti/([^/]+)":"pc-zhuanti"},touch:{"/dujia[/]?$":"touch-index","/dujia/.*/list/.*.html$":"touch-list","/dujia/tours/\\d+.html":"touch-detail","/dujia/booking/\\d+.html":"touch-booking","/dujia/zhuanti/(.*).html":"touch-zhuanti"},weixin:{"/ivacation[/]?$":"wx-index","/ivacation/.*/(gentuan)/.*$":"wx-list","/ivacation/.*/(ziyouxing)/.*$":"wx-list","/ivacation/tours/\\d+.html":"wx-detail","/ivacation/booking/\\d+.html":"wx-booking","/ivacation/zhuanti/(.*).html":"wx-zhuanti"},EBooking:{"/home/index[/]?":"pc-ebk-index","/productmanage/([^/]+)[/]?":"ebooking-product","/FlightManage/([^/]+)[/]?":"ebooking-FlightIndex","/OrderResourceConfirm/([^/]+)[/]?":"ebooking-OrderResourceConfirm","/Comment/([^/]+)[/]?":"ebooking-Comment"},localhost:"localhost"},getBodyPageId:function(){return $("html").attr("trace")},getPageId:function(){var o,t=this,e=location.href.split("?")[0],n=t.pageidMap,r=t.hostMap,i=t.getBodyPageId();if(i)return i;for(var a in r)if(r.hasOwnProperty(a)){var s=new RegExp(a),c=s.exec(e);if(c){o=r[a];break}}if(!o||!n[o])return"other";var d=n[o];for(var a in d)if(d.hasOwnProperty(a)){var u=new RegExp(a).exec(e);if(u){var l=d[a],g="";return u[1]&&(g="-"+u[1].replace(/\//g,"-")),l+g}}},init:function(){var o=this;if($.fn){var t=$.fn.on;$.fn.on=function(){for(var e,n,r=arguments,i=0,a=r.length-1;i<=a;i++)if("function"==typeof r[i]){n=r[i],e=i;break}return n&&(r[e]=function(){try{return n.apply(this,arguments)}catch(t){o.log(t.stack||t.message,"event."+r[0])}}),t.apply(this,r)}}},module:function(o,t){var e=this;if(o&&!e.getLogStatus()){var n;for(var r in o)o.hasOwnProperty(r)&&(n=o[r],"function"==typeof n&&(o[r]=function(o,t,n){return function(){try{return t.apply(this,arguments)}catch(t){return e.log("module:"+n+"|function:"+o+"|message:"+t.stack||t.message,"module"),!0}}}(r,n,t)))}},browserCfg:{def:{ie:/trident\/([\w.]+)/i,oldie:/msie\s([\w.]+)/i,chrome:/chrome\/([\w.]+)/i,firefox:/firefox\/([\w.]+)/i,app:/TcTravel\/([\w.]+)/i,weixin:/MicroMessenger\/([\w.]+)/i,uc:/UCBrowser\/([\w.]+)/i,baidubox:/baiduboxapp\/([\w.]+)/i,qqbrowser:/mqqbrowser\/([\w.]+)/i},extra:{chrome:/chrome\/([\w.]+)/i,safari:/safari\/([\w.]+)/i}},getBrowser:function(o,t){for(var e in t){var n=e,r=t[n].exec(o);if(r)return{browser:n,version:r[1]||"0",ua:o,bv:n+(r[1]||"0"),ip:"{ip}"}}},browser:function(o){var t=this,e=t.browserCfg,n=t.getBrowser(o,e.def);return n||(n=t.getBrowser(o,e.extra)),n||{browser:"other",version:"0",ua:o,bv:"other",ip:"{ip}"}},ua:function(){var o=this;if(o.uaData)return o.uaData;var t=navigator.userAgent;return o.uaData=$.extend({},o.platform(t),o.browser(t)),o.uaData},platform:function(o){var t={android:/android\s([\w.]+)/i,ios:/iphone\sos\s([\w.]+)/i,window:/Windows\sNT\s([\w.]+)/i},e="other";for(var n in t){var r=n,i=t[r].exec(o);i&&(e=r+(i[1]||"0"))}return{platform:e}},log:function(o,t,e){var n,r,i=this,a=!1;if(o){"string"==typeof e?n=e:"object"==typeof e&&(n=e.pageid,a=e.error),"object"==typeof o&&(o=i.stringify(o)),r=encodeURIComponent(o),n||(n=i.pageid||i.getPageId());var s=i.ua(),c={url:encodeURIComponent(location.href),errortype:t||"other",host:location.host,pageid:n||"0",refer:encodeURIComponent(document.referrer)};$.extend(c,s),c.message=r;var d=i._sub(c,a);!i.getLogStatus()&&i.index(r)&&i.send(i.prefix+"&frontlog="+d),i.isConsole()&&console.error(d)}},debug:function(){var t=this,e=location.toString(),n=/console=([^\/]+)/.exec(e);t.getLogStatus()||o.console||(o.console={},o.console.log=function(){}),e.indexOf("console")>-1&&(o.console||(o.console={},o.console.log=function(){t.console.apply(t,arguments)})),n&&n[1]&&window.addEventListener("load",function(o){var t=n[1],e="http://10.14.84.206:1337",r=e+"/vorlon.js/"+t,i=document.createElement("script"),a=document.getElementsByTagName("head")[0];i.type="text/javascript",i.charset="utf-8",i.src=r,a.appendChild(i),console.log("调试地址:"+e+"/dashboard/"+t)},!1)},console:function(){var o=this,t=Array.prototype.join.call(arguments,",");o.consoleWin||($("body").append('<pre id="J_console" style="position:fixed;bottom: 0;left:0;width:100%;height: 32px;z-index: 1000000;background-color: #000;color: #0f0;overflow-y: scroll;"></pre>'),o.consoleWin=document.getElementById("J_console"),o.consoleMsg=[]),o.consoleMsg.push(t),o.consoleWin.innerHTML=o.consoleMsg.join("<br/>"),o.consoleWin.scrollTop=16*o.consoleMsg.length}}),n.prototype=new e,$.extend(n.prototype,{performance:function(t){var e=this,n="//www.ly.com/dujia/ajaxhelper/commonhandler.ashx?action=FRONTPERFORMANCE&type=FrontLogList",r=o.performance||o.mozPerformance||o.msPerformance||o.webkitPerformance;if(r){t||(t=e.getPageId());var i=r.timing,a={app:"用户本地耗时",dns:"DNS查找时间",network:"dns和连接耗时",send:"首包时间",backend:"server响应耗时",interactive:"可操作时间",frontend:"前端处理耗时",domReady:"domReady",firstPaint:"首次渲染",load:"完全加载",pageid:"页面id",host:"当前域名"},s={app:i.domainLookupStart-i.navigationStart,dns:i.domainLookupEnd-i.domainLookupStart,network:i.requestStart-i.domainLookupStart,send:i.responseStart-i.requestStart,backend:i.responseEnd-i.requestStart,frontend:i.loadEventEnd-i.responseEnd,interactive:i.domInteractive-i.navigationStart,domReady:i.domContentLoadedEventStart-i.navigationStart,load:i.loadEventEnd-i.navigationStart,pageid:t||0,host:location.host};if(i.msFirstPaint&&(s.firstPaint=i.msFirstPaint),o.chrome&&o.chrome.loadTimes){var c=o.chrome.loadTimes();s.firstPaint=Math.round(1e3*(c.firstPaintTime-c.startLoadTime))}if(o.console){var d={};for(var u in s)d[a[u]]=s[u];console.log(d)}var l=e.stringify(s);return e.send(n+"&frontlog="+l),s}},stat:function(o,t){var e=this,n=e.ua(),r={host:location.host,errortype:"stat-"+o,pageid:e.pageid||e.getPageId()||"other",url:encodeURIComponent(location.href)},i=$.extend(r,n),a=e.stringify($.extend(i,t));e.send(e.prefix+"&frontlog="+a)},init:function(t){var e=this;if(!e.isInit){e.isInit=!0;var n=document.currentScript;n&&(t=n.getAttribute("pageid")),e.pageid=t,$(o).on("beforeunload",function(){e.performance(t);var n=o.statStack;n&&e[n.method](n.type,n.data)}),e.getLogStatus()||(o.onerror=function(o,t,n){return e.log("message:"+o+",url:"+t+",line:"+(""|n),"uncaught"),!0}),o.monitorStack&&o.monitorStack.length&&(e.log(o.monitorStack.join(","),"404"),o.monitorStack=[]),e.debug()}}}),window.Monitor=window.monitorModule=new n,Monitor.init()}(window);