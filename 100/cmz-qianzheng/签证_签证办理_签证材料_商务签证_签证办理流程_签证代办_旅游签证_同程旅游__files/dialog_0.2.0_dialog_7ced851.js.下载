define("dialog/0.2.0/dialog",["base/0.1.0/base"],function(t){t("base/0.1.0/base");var e=Base.extend({initialize:function(){e.superclass.initialize.apply(this,arguments),e.prototype.init.apply(this,arguments)},init:function(t){t=t||{};var e=this,i=t.type||"html",l=t.skin||"",n=t.html||"",s=t.title||"",a=t.content||"",h=t.lock||!1,r=h&&(t.mask||!1),d=t.zIndex||5850,g=t.width||"50%",c=t.height||"50%",u=t.border||"none",f=t.top||"25%",m=t.left||"25%",p=t.url||null,v=t.quickClose||!1,b=t.time||(0==t.time?0:-1),_=t.isdrag;void 0==_&&(_=!0);var w,k,y=$("<div/>").addClass("ui_dialog_gp").css({width:g,height:c,border:u});h&&(w=$("<div/>").addClass("ui_dialog_mask"),r&&w.addClass("mask"),w.appendTo("body")),y.appendTo("body"),k=y,k.addClass(l),y.html(n);var x=y.find("[data-dialog-content]"),j=y.find("[data-dialog-title]");k.delegate("[data-dialog-hide]","click",function(){e.hide()}),k.delegate("[data-dialog-show]","click",function(){e.hide()}),k.delegate("[data-dialog-close]","click",function(){e.close()}),k.delegate("[data-dialog-submit]","click",function(){e.hide(),e.trigger("submit")}),k.delegate("[data-dialog-cannel]","click",function(){e.hide(),e.trigger("cannel")});var T;if(k.delegate("[data-dialog-drag]","mousedown",function(t){_&&(T=T||new o,T.create(y[0],t))}),y.hover(function(){e.inobj=!0,e.trigger("hoverin")},function(){e.inobj=!1,e.trigger("hoverout")}),b>=0){var C;e.on("hoverout",function(){e.inele||e.inobj||(0==b?e.hide():C=setTimeout(function(){e.hide()},b))}),e.on("hoverin",function(){C&&(clearTimeout(C),delete C)})}this.set("type",i),this.set("html",n),this.set("title",s),this.set("content",a),this.set("url",p),this.set("mask",r),this.set("skin",l),this.set("isdrag",_),this.set("time",b),this.set("lock",h),this.set("width",g),this.set("height",c),this.set("top",f),this.set("left",m),this.set("quickClose",v),this.set("zIndex",d),this.set("obj_mask",w),this.set("obj_dialog",k),this.set("obj_gp",y),this.set("obj_content",x),this.set("obj_title",j)},ATTRS:{type:"template",html:null,title:null,titlestyle:null,titlehtml:null,content:{value:null},lock:!1,mask:!1,quickClose:!1,zIndex:101,width:"50%",height:"50%",x:"25%",y:"25%",url:null,template:null,time:-1,closetype:"event",isdrag:!0,id:null,bghtml:null,bgstyle:null,iscreate:!1,obj_mask:null,obj_dialog:null,obj_gp:null,obj_title:null,obj_content:null,obj_addhere:null},show:function(t,e,i){var o=this;o.trigger("show"),i=i||!1;var l=this.get("obj_gp"),n=this.get("lock");l.css({width:this.get("width"),height:this.get("height")});var s=this.get("iscreate");if(l.css("visibility","hidden"),l.show(),this.render(),s&&!i)return void(n&&this.get("obj_mask").show());void 0!=e&&o.changePoint(t,l,e),n&&this.get("obj_mask").show();var a=this.get("quickClose");a&&($(document).on("keydown",function(t){var e=t.target,i=e.nodeName,l=/^input|textarea$/i,n=!0,s=t.keyCode;!n||l.test(i)&&"button"!==e.type||(27===s&&o.hide(),t.cancelBubble=!0)}),this.get("obj_mask").on("onmousedown"in document?"mousedown":"click",function(){return o.hide(),!1})),l.css("visibility","visible"),this.set("iscreate",!0)},hide:function(){this.trigger("hide"),this.get("lock")&&this.get("obj_mask").fadeOut(),this.get("obj_gp").hide()},close:function(){this.trigger("close"),this.get("lock")&&(this.get("obj_mask").fadeOut(),this.get("obj_mask").remove()),this.get("obj_gp").remove()},refresh:function(t){return this.set("iscreate",!1),this.render(t)},render:function(t){var e=this.get("type"),i=this.get("url"),o=this.get("title");if(t?this.o_triggerobj=t:t=this.o_triggerobj,"div"==e)this.get("obj_content").load(i);else if("html"==e){var l=this.get("content"),n="";if(n="function"==typeof l?l(t):l,void 0==n||null==n||""==n)return!1;this.get("obj_content").html(n)}return this.get("obj_title").html(o),!0},changePoint:function(t,e,i){var o=this,l=e.children()[0].offsetHeight,n=e.children()[0].offsetWidth,s=$(window),a=e.find("[data-dialog-arrows]"),h=e.find("[dialog-berchmask]"),r=s.width(),d=s.height(),g=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop,c=document.documentElement.scrollLeft||window.pageXOffset||document.body.scrollLeft,u=o.get("zIndex");if("center"==i)return void e.css({position:"fixed","z-index":u,margin:"auto",bottom:0,right:0,top:0,left:0,height:l+"px"});var f=this.__offset(t),m=f.top,p=f.left,v=t.offsetWidth,b=t.offsetHeight,_=i.match(/\S+/g),w=_[0],k=_.length>1?_[1]:"center",y=8,x={top:null,left:null,bottom:null,right:null,width:v,height:b},j={top:null,left:null,right:null,bottom:null},T={top:null,left:null,bottom:null,right:null};if("bottom"==w?(j.top=y+b+m,T.top=-1*y,"left"==k?(j.left=p,T.left=v/2-y):"right"==k?(j.right=p,T.right=v/2-y):(j.left=p-(n-v)/2,T.left=n/2-y),x.height+=10,x.top=0-y-b,x.left=0):"top"==w?(j.top=m-y-l,T.bottom=-1*y,"left"==k?(j.left=p,T.left=v/2-y):"right"==k?(j.right=p,T.right=v/2-y):(j.left=p+(v-n)/2,T.left=n/2-y),x.height+=10,x.bottom=0-y-b,x.left=0):"left"==w?(j.left=p-y-n,T.right=0-y,"top"==k?(j.top=m,T.top=b/2-y):"bottom"==k?(j.bottom=m+b,T.bottom=b/2-y):(j.top=m+(b-l)/2,T.top=l/2-y),x.height+=10,x.bottom=0-y-b,x.left=0):"right"==w&&(j.left=p+v+y,T.left=0-y,"top"==k?(j.top=m,T.top=b/2-y):"bottom"==k?(j.bottom=m+b,T.bottom=b/2-y):(j.top=m+(b-l)/2,T.top=l/2-y),x.width+=10,x.left=0-y-v,x.top=0),"bottom"==w||"top"==w){var C=n+j.left-r-c,z=l+j.top-d-g;if(C>0&&(j.left-=C,T.left+=C,x.left+=C),j.left<0&&(C=0-j.left,T.left-=C,j.left=0),z>0)return void o.changePoint(t,e,"top "+k);if(-1*j.top>l+y)return void o.changePoint(t,e,"bottom "+k)}else{var C=n+j.left-r-c,z=l+j.top-d-g;if(z>0&&(j.top-=z,T.top+=z,x.top+=z),C>0)return void o.changePoint(t,e,"left "+k);if(-1*j.left>n+y)return void o.changePoint(t,e,"right "+k)}e.css({position:"absolute","z-index":u,bottom:j.bottom||"auto",right:j.right||"auto",top:j.top||"auto",left:j.left||"auto"}),a.removeClass("top bottom left right").addClass(w),a.css({bottom:T.bottom||"auto",right:T.right||"auto",top:T.top||"auto",left:T.left||"auto"}),h.css({bottom:x.bottom||"auto",right:x.right||"auto",top:x.top||"auto",left:x.left||"auto",width:x.width||"auto",height:x.height||"auto"})},triggerShow:function(t){var e=t.triggerEle||"",i=t.triggerType||"",o=t.triggerAlign||"",l=t.leaveHide||!1,n=t.wrapper||document;i=i||"click",o=o||"bottom";var s,a=this,h=$(e);"hover"==i?(a.ishover=!0,$(n).delegate(e,"mouseover",function(){a.refresh(this)&&(a.show(this,o,!0),a.inele=!0)}),$(n).delegate(e,"mouseout",function(){a.inele=!1,s&&window.clearTimeout(s),s=window.setTimeout(function(){a.trigger("hoverout"),s=null},100)})):"click"==i?($(n).delegate(e,"click",function(){a.refresh(this)&&a.show(this,o,!0)}),l&&$(n).delegate(e,"mouseout",function(){a.inele=!1,s&&window.clearTimeout(s),s=window.setTimeout(function(){a.trigger("hoverout"),s=null},100)})):"show"==i?a.show(h[0],o,!0):$(n).delegate(e,i,function(){t.onTrigger&&t.onTrigger(this,a)})},open:function(t){if(t){var e=t.type||this.get("type"),i=t.skin||this.get("skin"),o=t.html||this.get("html"),l=t.title||this.get("title"),n=t.content||this.get("content"),s=t.lock||this.get("lock"),a=s&&(t.mask||this.get("mask")),h=t.width||this.get("width"),r=t.height||this.get("height"),d=t.top||this.get("top"),g=t.left||this.get("left"),c=t.url||this.get("url"),u=t.quickClose||this.get("quickClose"),f=t.time;void 0==f&&(f=this.get("time"));var m=t.isdrag;void 0==m&&(m=this.get("isdrag")),this.set("type",e),this.set("html",o),this.set("title",l),this.set("content",n),this.set("url",c),this.set("mask",a),this.set("skin",i),this.set("isdrag",m),this.set("time",f),this.set("lock",s),this.set("width",h),this.set("height",r),this.set("top",d),this.set("left",g),this.set("quickClose",u),this.refresh(),this.show()}},__follow:function(t){var e=t.parentNode&&$(t),i=this.__popup;if(this.__followSkin&&i.removeClass(this.__followSkin),e){var o=e.offset();if(o.left*o.top<0)return this.__center()}var l=this,n=this.fixed,s=$(window),a=$(document),h=s.width(),r=s.height(),d=a.scrollLeft(),g=a.scrollTop(),c=i.width(),u=i.height(),f=e?e.outerWidth():0,m=e?e.outerHeight():0,p=this.__offset(t),v=p.left,b=p.top,_=n?v-d:v,w=n?b-g:b,k=n?0:d,y=n?0:g,x=k+h-c,j=y+r-u,T={},C=this.align.split(" "),z=this.className+"-",S={top:"bottom",bottom:"top",left:"right",right:"left"},E={top:"top",bottom:"top",left:"left",right:"left"},q=[{top:w-u,bottom:w+m,left:_-c,right:_+f},{top:w,bottom:w-u+m,left:_,right:_-c+f}],I={left:_+f/2-c/2,top:w+m/2-u/2},L={left:[k,x],top:[y,j]};$.each(C,function(t,e){q[t][e]>L[E[e]][1]&&(e=C[t]=S[e]),q[t][e]<L[E[e]][0]&&(C[t]=S[e])}),C[1]||(E[C[1]]="left"===E[C[0]]?"top":"left",q[1][C[1]]=I[E[C[1]]]),z+=C.join("-")+" "+this.className+"-follow",l.__followSkin=z,e&&i.addClass(z),T[E[C[0]]]=parseInt(q[0][C[0]]),T[E[C[1]]]=parseInt(q[1][C[1]]),i.css(T)},__offset:function(t){var e=t.parentNode,i=e?$(t).offset():{left:t.pageX,top:t.pageY};t=e?t:t.target;var o=t.ownerDocument,l=o.defaultView||o.parentWindow;if(l==window)return i;var n=l.frameElement,s=$(o),a=s.scrollLeft(),h=s.scrollTop(),r=$(n).offset(),d=r.left,g=r.top;return{left:i.left+d-a,top:i.top+g-h}}}),i=Base.extend({initialize:function(){i.superclass.initialize.apply(this,arguments),i.prototype.init.apply(this,arguments)},init:function(t){function e(t,i){return void 0==i?t:($.each(t,function(o,l){void 0!=i[o]&&(t[o]="object"==typeof l?e(t[o],i[o]):i[o])}),t)}t=t||{};var i='<div class="dialog_modal_gp"><div class="dialog_modal_title"  data-dialog-drag><div class="text" data-dialog-title></div><a href="javascript:;" class="close" data-dialog-hide></a></div><div class="dialog_modal_content" data-dialog-content></div></div>',o={alert:{width:"200px",height:"120px",html:'<div class="dialog_alert_gp" data-dialog-drag><div class="dialog_alert_text" data-dialog-content></div><button type="button" class="dialog_alert_submit" data-dialog-submit>确认</button></div>'},confirm:{width:"200px",height:"120px",html:'<div class="dialog_confirm_gp" data-dialog-drag><div class="dialog_confirm_text" data-dialog-content></div><button type="button" class="dialog_confirm_submit" data-dialog-submit>确认</button><button type="button" class="dialog_confirm_cannel" data-dialog-cannel>取消</button></div>'},tooltip:{width:"270px",height:"auto",border:"none",zIndex:1e6,html:'<div class="dialog_tooltip_gp" trace="dialog_tooltip" data-dialog-drag style="color:#000;"><div class="dialog_berch_mask"></div><div class="dialog-arrow" data-dialog-arrows> <div class="dialog-arrow-a"></div><div class="dialog-arrow-b"></div></div><div class="dialog_tooltip_text" style="text-align:left;" data-dialog-content></div></div>'},tips:{width:"150px",height:"auto",html:'<div class="dialog_tooltip_gp" trace="dialog_tooltip" data-dialog-drag style="width:100%;color:#000;border-radius: 5px;"><div class="dialog_tooltip_text" style="text-align:left;line-height:30px;" data-dialog-content></div></div>'},modal:{width:"600px",height:"440px",html:i},validata:{width:"auto",height:"auto",border:"none",html:'<div class="dialog_validata_gp" data-dialog-drag style="color:#000;"><div class="dialog_validata_text" data-dialog-content></div></div>'}},l=e(o,t.template);this.set("template",l),this.set("skin",t.skin||"black")},ATTRS:{type:"template",skin:"skin1",template:{alert:null,confirm:null,modal:{title:""}}},tempinit:function(){},alert:function(t,i){var o=this.get("template"),l=o.alert.width,n=o.alert.height,s=o.alert.html,a=this.get("skin"),h={type:"html",lock:!0,skin:a,width:l,height:n,html:s,content:t,end:""};return this._alertmodal?(this._alertmodal.open(h),this._alertmodal.off("submit")):(this._alertmodal=new e(h),this._alertmodal.show()),i&&this._alertmodal.on("submit",i),this._alertmodal.get("obj_content").find("[data-dialog-submit]").focus(),this._alertmodal},confirm:function(t,i,o){var l=this.get("template"),n=l.confirm.width,s=l.confirm.height,a=l.confirm.html,h=this.get("skin"),r={type:"html",lock:!0,skin:h,width:n,height:s,html:a,content:t,end:""};return this._confirmmodal?(this._confirmmodal.open(r),this._confirmmodal.off("submit"),this._confirmmodal.off("cannel")):(this._confirmmodal=new e(r),this._confirmmodal.show()),i&&this._confirmmodal.on("submit",i),o&&this._confirmmodal.on("cannel",o),this._confirmmodal.get("obj_content").find("[data-dialog-submit]").focus(),this._confirmmodal},tooltip:function(t){var i=this.get("template");$.extend(i.tooltip,t);var o=this.get("skin"),l={type:"html",lock:!1,content:t.content,time:t.delay||0,isdrag:!1,skin:o,end:""},n=$.extend(l,i.tooltip),s=new e(n);return t.onhide&&s.on("hide",t.onhide),t.triggerEle&&s.triggerShow(t),s},tips:function(t){var i=this.get("template"),o=i.tips.width,l=i.tips.height,n=i.tips.html,s=this.get("skin"),a={type:"html",lock:!1,skin:s,width:o,height:l,html:n,content:t.content,time:0,isdrag:!1,end:""},h=new e(a);return h.show(t.triggerEle,t.triggerAlign),setTimeout(function(){h.close()},t.delay),h},modal:function(t){var i=this.get("template"),o=i.modal.width,l=i.modal.height,n=i.modal.html,s=this.get("skin");if("string"==typeof t)return this.modal&&this._modal[t](),this.modal;var a=t||{},h={type:a.type||"html",lock:!0,mask:!0,skin:s,width:a.width||o,height:a.height||l,title:a.title||"",html:n,content:a.content||"&nbsp;",url:a.url||null,quickClose:!0,end:""};return $.extend(h,a),this._modal?this._modal.open(h):(this._modal=new e(h),t.onShow&&this._modal.on("show",t.onShow),this._modal.show()),this._modal},validata:function(t){var i=this.get("template");$.extend(i.validata,t);var o=i.validata.width,l=i.validata.height,n=i.validata.html,s=i.validata.border,a=this.get("skin"),h={type:"html",lock:!1,skin:a,width:o,height:l,border:s,html:n,content:t.content,time:t.delay||0,isdrag:!1,end:""},r=new e(h);return t.onhide&&r.on("hide",t.onhide),t.triggerEle&&r.triggerShow(t),r}}),o=function(){var t=$(window),e=$(document),i="createTouch"in document,o=document.documentElement,l=!("minWidth"in o.style),n=!l&&"onlosecapture"in o,s="setCapture"in o,a={start:i?"touchstart":"mousedown",over:i?"touchmove":"mousemove",end:i?"touchend":"mouseup"},h=i?function(t){return t.touches||(t=t.originalEvent.touches.item(0)),t}:function(t){return t},r=function(){this.start=$.proxy(this.start,this),this.over=$.proxy(this.over,this),this.end=$.proxy(this.end,this),this.onstart=this.onover=this.onend=$.noop};return r.types=a,r.prototype={start:function(t){return t=this.startFix(t),e.on(a.over,this.over).on(a.end,this.end),this.onstart(t),!1},over:function(t){return t=this.overFix(t),this.onover(t),!1},end:function(t){return t=this.endFix(t),e.off(a.over,this.over).off(a.end,this.end),this.onend(t),!1},startFix:function(i){return i=h(i),this.target=$(i.target),this.selectstart=function(){return!1},e.on("selectstart",this.selectstart).on("dblclick",this.end),n?this.target.on("losecapture",this.end):t.on("blur",this.end),s&&this.target[0].setCapture(),i},overFix:function(t){return t=h(t)},endFix:function(i){return i=h(i),e.off("selectstart",this.selectstart).off("dblclick",this.end),n?this.target.off("losecapture",this.end):t.off("blur",this.end),s&&this.target[0].releaseCapture(),i}},r.create=function(i,o){var l,n,s,a,h=$(i),d=new r,g=r.types.start,c=function(){},u=i.className.replace(/^\s|\s.*/g,"")+"-drag-start",f={onstart:c,onover:c,onend:c,off:function(){h.off(g,d.start)}};return d.onstart=function(o){var r="fixed"===h.css("position"),d=e.scrollLeft(),g=e.scrollTop(),c=h.width(),m=h.height();l=0,n=0,s=r?t.width()-c+l:e.width()-c,a=r?t.height()-m+n:e.height()-m;var p=h.offset(),v=this.startLeft=r?p.left-d:p.left,b=this.startTop=r?p.top-g:p.top;this.clientX=o.clientX,this.clientY=o.clientY,h.addClass(u),f.onstart.call(i,o,v,b)},d.onover=function(t){var e=t.clientX-this.clientX+this.startLeft,o=t.clientY-this.clientY+this.startTop,r=h[0].style;e=Math.max(l,Math.min(s,e)),o=Math.max(n,Math.min(a,o)),r.left=e+"px",r.top=o+"px",r.bottom="auto",r.right="auto",f.onover.call(i,t,e,o)},d.onend=function(t){var e=h.position(),o=e.left,l=e.top;h.removeClass(u),f.onend.call(i,t,o,l)},d.off=function(){h.off(g,d.start)},o?d.start(o):h.on(g,d.start),f},r};return i});